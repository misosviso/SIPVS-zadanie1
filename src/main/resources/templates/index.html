<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <title>Review Form</title>
    <style>
        .ratings-wrapper {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .rating {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <h1>Restaurant Review Form</h1>
    <hr />

    <!-- Generate XML from form to static path -->
    <form action="#" th:action="@{/}" th:object="${form}" method="post" id="mainForm">
        <p>First Name: <input type="text" th:field="*{firstName}" /></p>
        <p>Last Name: <input type="text" th:field="*{lastName}" /></p>
        <p>Email Address: <input type="text" th:field="*{emailAddreess}" /></p>

        <!-- Repeating section with Restaurant Address, Rating, Comment and Visit date -->
        <div class="ratings-wrapper">
            <div id="ratings" th:each="ratingItem, ratingItemStat : *{ratings}">
                <div class="rating">
                    <p>Restaurant Address: <input type="text" th:field="*{ratings[__${ratingItemStat.index}__].restaurantAddress}" /></p>
                    <p>Restaurant Rating: <input type="text" th:field="*{ratings[__${ratingItemStat.index}__].restaurantRating}" oninput="validateRating(this)" /></p>
                    <p>Restaurant Comment: <input type="text" th:field="*{ratings[__${ratingItemStat.index}__].restaurantComment}" /></p>
                    <p>Visit Date: <input type="date" th:field="*{ratings[__${ratingItemStat.index}__].visitDate}" /></p>
                </div>
            </div>
            <span id="rating-error-message" style="color:red;"></span>
            <p><input type="submit" value="Add Rating Section" onclick="addRatingSection()" formaction="/add" /></p>
        </div>

        <p><input type="submit" value="Generate XML" formaction="/generate" /></p>
        <p><input type="submit" value="Validate XML" formaction="/validate" /></p>
        <p><span th:text="${validationSuccess}" style="color:green" /></p>
        <p><span th:text="${validationError}" style="color:red" /></p>

        <p><input type="submit" value="Generate HTML" formaction="/html" /></p>
    </form>

    <script>
        function validateRating(input) {
            var rating = input.value;
            var errorMessage = document.getElementById("rating-error-message");

            if (rating < 1 || rating > 5) {
                errorMessage.textContent = "Rating must be between 1 and 5.";
                // document.getElementById("mainForm").querySelector('[type="submit"]').disabled = true;
            } else {
                errorMessage.textContent = "";
                // document.getElementById("mainForm").querySelector('[type="submit"]').disabled = false;
            }
        }

        function addRatingSection() {
            var ratingsDiv = document.getElementById("ratings");
            var newIndex = ratingsDiv.children.length;
            var newSection = document.createElement("div");
            newSection.className = "rating";
            newSection.innerHTML = `
                <p>Restaurant Address: <input type="text" name="form.ratings[${newIndex}].restaurantAddress" /></p>
                <p>Restaurant Rating: <input type="text" name="form.ratings[${newIndex}].restaurantRating" oninput="validateRating(this)" /></p>
                <p>Restaurant Comment: <input type="text" name="form.ratings[${newIndex}].restaurantComment" /></p>
                <p>Visit Date: <input type="date" name="form.ratings[${newIndex}].visitDate" /></p>
            `;
            ratingsDiv.appendChild(newSection);
        }
    </script>

</body>

</html>